'use strict';const PI2=2*Math.PI,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;let currentTime,deltaTime=0,deltaTimes=[],fpsCounter=0,lastFpsTime=0,fpsValue=0,fpsValues=[];Number.prototype.mod=function(a){return(this%a+a)%a};Array.prototype.pushArray=function(){this.push.apply(this,this.concat.apply([],arguments))};function createHtmlElement(a,c,b,d=null,f=null){a=document.createElement(a);c&&(a.id=c);d&&(a.style.cssText=d);f&&(a.innerHTML=f);b&&b.appendChild(a);return a}
class App{constructor(a,c){this.isApp=!0;this.name=a=a||"App"+App.instances.length;c=c||{};this.parentElement=c.parentElement||document.body;this.wrapperElement=c.parentElement||createHtmlElement("div",a+"_Wrapper",this.parentElement,"width:100%; height:100%; font: 5vmin Arial;");this.canvasElement=c.canvasElement||createHtmlElement("canvas",a+"_Canvas",this.wrapperElement,"position: absolute; width:100%; height:100%; z-index: 0;");this.loading={element:c.loadingElement||createHtmlElement("div",a+
"_Console",this.wrapperElement,"position: absolute; width:100%; height:100%; z-index: 1000;background: white; color: blue; font: 5vmin Arial;display: flex; justify-content: center; align-items: center;",'<div style="text-align:center"><h2>LOADING</h2><p>[]</p></div>'),state:0,updated:!1};this.console={element:c.consoleElement||createHtmlElement("div",a+"_Console",this.wrapperElement,"position: absolute; width:100%; height:100%; z-index: 2000;background: #00000080; color: white; font: 2vmin Arial;"),
state:c.consoleState,position:c.consolePosition,stats:{fps:0},messages:[],errorMessage:"",updated:!1};this.parentElement===document.body&&createHtmlElement("style",null,document.head,null,"* { margin: 0; cursor: default; overflow: hidden; }\nhtml, body { width:100%; height:100%; font-family: Verdana; }");this.renderer=new THREE.WebGLRenderer({canvas:this.canvasElement});this.renderer.autoClear=!1;this.layers=[];this.initFunction=c.initFunction||null;this.updateFunction=c.updateFunction||null;this.initFunction&&
this.initFunction(this);if(App.instances[a])throw Error("App instance '"+a+"' already exists");App.instances[a]=this;1===Object.keys(App.instances).length&&App.updateAll(0)}update(){this.renderer.clear();var a;let c=this.layers.length,b=this.wrapperElement.clientWidth,d=this.wrapperElement.clientHeight;if(this.width!==b||this.height!==d){this.aspectRatio=b/d;for(a=0;a<c;a++)this.layers[a].resize(this.aspectRatio);this.renderer.setSize(b,d);this.renderer.setPixelRatio(window.devicePixelRatio);this.width=
b;this.height=d;console.log("Viewport resized: "+b+"x"+d)}for(a=0;a<c;a++)this.layers[a].update();if(!this.loading.updated){a=this.loading.element;switch(this.loading.state){case 0:"none"!==a.style.display&&(a.style.display="none")}a.updated=!0}if(!this.console.updated){a=this.console.element;switch(this.console.state){case 0:"none"!==a.style.display&&(a.style.display="none");break;case 1:"block"!==a.style.display&&(a.style.display="block"),0==fpsCounter&&(a.style.height="3vmin",a.innerHTML="FPS: "+
fpsValue+" Triangles: "+this.renderer.info.render.triangles,this.console.errorMessage&&(a.innerHTML+='<span style="color:red; float:right;"> '+this.console.errorMessage+"</span>"))}a.updated=!0}this.updateFunction&&this.updateFunction(this)}static updateAll(a=0){if(currentTime)for(deltaTime=(a-currentTime)/1E3,deltaTimes.push(deltaTime),100<deltaTimes.length&&deltaTimes.splice(0,1),lastFpsTime+=deltaTime,fpsCounter++;1<lastFpsTime;)fpsValue=fpsCounter,100<deltaTimes.length&&deltaTimes.splice(0,1),
--lastFpsTime,fpsCounter=0;currentTime=a;Source.instances.forEach(a=>{a.update()});a=Object.keys(App.instances);let c=a.length;for(let b=0;b<c;b++)App.instances[a[b]].update();requestAnimationFrame(App.updateAll)}}App.instances={};window.onerror=function(a,c,b,d,f){c=Object.keys(App.instances);b=c.length;for(d=0;d<b;d++)App.instances[c[d]].console.errorMessage=a};class File{constructor(a,c){if(!a)throw Error("Invalid File name");this.name=a;this.isFile=!0;this.loaded=!1;this.path=c.path||null;this.format=c.format||"json";this.onload=c.onload||null;this.data=c.data||null;this.path&&this.load();if(File.Instances[a])throw Error("Repeated File name: "+a);File.Instances[this.name]=this}load(){console.log("Loading File: "+this.path);let a=new XMLHttpRequest;a.open("GET",this.path);a.responseType=this.format;a.sender=this;a.onload=function(c){this.sender.data=a.response;
if(this.sender.onload)this.sender.onload(this.sender);this.loaded=!0;console.log("Loaded File: "+this.sender.path)};a.onerror=function(a){throw Error("Unable to load File: "+this.sender.path);};a.send()}}File.Instances={};class Parameter{constructor(a,c,b={},d=0){this.name=a||"Parameter";this.parent=c;"object"==typeof b?b.isSource&&(b={source:b}):b={value:b};this.value=b.value;this.defaultValue=d;if(null==this.value||void 0==this.value)this.value=d;this.minValue=b.minValue||void 0;this.maxValue=b.maxValue||void 0;this.source=b.source||void 0;this.offset=b.offset||void 0;this.factor=b.factor||void 0;this.updated=!1;this.isParameter=!0;this.source&&(this.source.linkedParameters.push(this),console.log("Linked "+a+" to "+
this.source.name))}clone(a,c){return new Parameter(a?a:this.name,c?c:this.parent,this)}get(){return this.update()}set(a){void 0!==this.factor&&(a*=this.factor);void 0!==this.offset&&(a+=this.offset);void 0!==this.minValue&&a<this.minValue&&(console.log("Parameter "+(this.parent.name?this.parent.name+".":"")+this.name+" Minimum Value Reached:"+this.minValue),a=this.minValue);void 0!==this.maxValue&&a>this.maxValue&&(console.log("Parameter "+(this.parent.name?this.parent.name+".":"")+this.name+" Maximum Value Reached:"+
this.maxValue),a=this.maxValue);this.value=a;this.downdate()}downdate(){this.updated&&(this.updated=!1,this.parent.downdate?this.parent.downdate():this.parent.updated&&(this.parent.updated=!1))}update(){this.source&&this.value!==this.source.value&&this.set(this.source.value);if(this.updated)return this.value;this.updated=!0;return this.value}toString(){return this.value}};class Source{constructor(a,c={}){this.name=a||"Source";this.value=0;this.values=[];c.values&&c.values.forEach(a=>{this.values.push(a)});this.updated=!1;this.isSource=!0;this.linkedParameters=[];Source.instances.push(this)}update(){this.linkedParameters.forEach(a=>{a.set(this.value)});this.updated=!0}}Source.instances=[];class SineWaveGenerator extends Source{constructor(a,c={}){super(a,c);this.offset=c.factor||0;this.factor=c.factor||1E3;this.minValue=c.minValue||0;this.maxValue=c.maxValue||1}update(){this.value=(Math.sin(currentTime/this.factor+this.offset)+1)/2*(this.maxValue-this.minValue)+this.minValue;super.update()}};class Color{constructor(a=0,c=0,b=0,d=1){this.r=a;this.g=c;this.b=b;this.a=d;this.isColor=!0;this.updated=!1;this.parent=null}update(){this.updated||(this.updated=!0);this.parent&&this.parent.update&&this.parent.update();return new THREE.Color(this.r,this.g,this.b)}};class Vector{constructor(a){this.values=[];this.isVector=!0;this.updated=!1;this.dimensions=2;this.parent=null;let c,b=arguments.length;for(c=0;c<b;c++)this.setAt(c,arguments[c])}clone(){let a=new Vector;for(let c=0;c<this.values.length;c++)a.setAt(c,this.values[c]);a.parent=this.parent;return a}get(a=-1){let c=[],b,d=this.values.length;0>a&&(a=d);for(b=0;b<a;b++)c.push(b<d?this.values[b]:0);return c}getX(){return this.getAt(0)}getY(){return this.getAt(1)}getZ(){return this.getAt(2)}getAt(a){return a<
this.values.length?this.values[a]:0}set(){let a,c=arguments.length;for(a=0;a<c;a++)this.setAt(a,arguments[a])}setX(a){this.setAt(0,a)}setY(a){this.setAt(1,a)}setZ(a){this.setAt(2,a)}setAt(a,c){if(isNaN(c)||!isFinite(c))throw Error("Invalid value: "+c);this.values[a]=c;0==a?this.x=c:1==a?this.y=c:2==a&&(this.z=c);this.updated=!1;this.dimensions=this.values.length;this.parent&&(this.parent.updated=!1)}update(){this.updated||(this.updated=!0)}toString(a=2){let c="";this.values.forEach((b,d)=>{c+=(0<
d?", ":"")+b.toFixed(a)});return"{"+c+"}"}static equals(a,c){if(!a||!c||a.values.length!==c.values.length)return!1;for(let b=0;b<a.values.length;b++)if(a.values[b]+1E-5<c.values[b]||a.values[b]-1E-5>c.values[b])return!1;return!0}};class Font{constructor(a,c){if(!a)throw Error("Invalid font name");if(!c)throw Error("Invalid font filePath");this.name=a;this.filePath=c;this.loaded=!1;this.glyphs={};this.file=new File("Font "+a,{path:c,onload:a=>{this.loadJson(a.data)}});if(Font.instances[a])throw Error("Font '"+a+"' already exists");Font.instances[a]=this}loadJson(a){this.loaded=!1;this.resolution=a.resolution;this.ascender=a.ascender/a.resolution;this.descender=a.descender/a.resolution;this.lineHeight=this.ascender-this.descender;
this.glyphs={};let c=1/this.resolution,b=Object.keys(a.glyphs),d=b.length;for(let g=0;g<d;g++){let d=b[g],m=a.glyphs[d];var f=m.o;f&&(f=ShapeUtils.readSvgPath(f,{scale:c}),f.reversed=!0,f.update(!0,{dimensions:2}),this.glyphs[d]={path:f,ha:m.ha/a.resolution})}this.loaded=!0}}Font.instances={};class Modifier{constructor(a){}apply(a){}};class Path{constructor(a={}){this.segments=[];a.segments&&a.segments.forEach(a=>{this.segments.push(a.clone())});let c=this.data={};c.parts=a.parts||[];c.vertices=a.vertices||[];c.lengths=a.lengths||[];c.tangents=a.tangents||[];c.normals=a.normals||[];c.binormals=a.binormals||[];c.edges=a.edges||[];c.holes=a.holes||[];c.faces=a.faces||[];c.vertexCount=0;this.modifiers=[];a.modifiers&&(this.modifiers=[...a.modifiers]);this.isPath=!0;this.reverse=a.reversed||!1;this.updated=a.updated||!1;this.dimensions=
a.dimensions||0}clone(){return new Path(this)}join(a,c=null,b,d=null){this.updated||this.update();a.updated||a.update();this.segments.pushArray(a.segments);b=this.data.vertices.length/3;let f=a.data.vertices.length,g=a.data.edges.length,h=a.data.faces.length;for(let b=0;b<f;b++){let f=a.data.vertices[b];c&&(f+=c.getAt(b%3));d&&(f*=d.getAt(b%3));this.data.vertices.push(f);this.data.tangents.push(a.data.tangents[b]);this.data.normals.push(a.data.normals[b]);this.data.binormals.push(a.data.binormals[b])}for(c=
0;c<g;c++)this.data.edges.push(a.data.edges[c]+b);for(c=0;c<h;c++)this.data.faces.push(a.data.faces[c]+b);this.data.vertexCount=this.data.vertices.length/3;this.updated=!0;return this}update(a,c={}){if(!this.updated||a){a=this.data;a.parts=[];a.vertices=[];a.lengths=[];a.angles=[];a.tangents=[];a.normals=[];a.binormals=[];a.edges=[];a.holes=[];a.faces=[];var b,d=this.segments.length;if(0!=d){if(c.dimensions)this.dimensions=c.dimensions;else for(this.dimensions=2,b=0;b<d;b++){this.segments[b].update();
var f=this.segments[b].dimensions;this.dimensions<f&&(this.dimensions=f)}f=this.dimensions;var g=2==this.dimensions,h=c.minLength||.001;b=c.maxLength||Infinity;var m=c.minAngle||.001,l=c.maxAngle||Segment.defaultMaxAngle,e=c.reversed||this.reversed;h>b&&(h=b);m>l&&(m=l);var k={vertices:[],closed:!1};c=!0;var q=this.segments[0].pointStart;for(b=0;b<d;b++){var n=this.segments[b],p=this.segments[(b+1)%d],u=Vector.equals(n.pointEnd,p.pointStart);n.update(!0,{dimensions:f,skipLastPoint:u});k.vertices.pushArray(n.vertices);
u&&b!=d-1||(k.closed=Vector.equals(n.pointEnd,q),k.closed||(c=!1),a.parts.push(k),k={vertices:[],closed:!1},q=p.pointStart)}if(e)for(b=a.parts.length,d=0;d<b;d++){e=a.parts[d];k=[];for(q=e.vertices.length/2-1;0<=q;q--)p=2*q,n=e.vertices[p++],p=e.vertices[p++],k.push(n,p);e.vertices=k}b=this.modifiers.length;for(d=0;d<b;d++)this.modifiers[d].apply(a.parts);b=a.parts.length;for(d=0;d<b;d++){e=a.parts[d];let c,G;let C=n=0,D=0,I=1,J=0,K=0,L=-1;q=0;k=0;let N;if(e.closed){var r=e.vertices.length-f;p=e.vertices[0]-
e.vertices[r++];u=e.vertices[1]-e.vertices[r++];var t=g?0:e.vertices[2]-e.vertices[r++];r=Math.sqrt(p*p+u*u+t*t);if(0<r){var y=p/r;var E=u/r;N=g?0:t/r;if(g){var A=-E;var v=y}else A=1,v=0;q=0}}t=0;u=e.vertices.length/f;let M,O;for(;t<u;){p=t+1;M=0==t;O=p==u;let b=t*f;t=e.vertices[b];c=e.vertices[b+1];G=g?0:e.vertices[b+2];let d=!1,H=u+(e.closed?1:0);for(;p<=H&&(e.closed||!O);){b=p%u*f;var w=e.vertices[b];r=e.vertices[b+1];var z=g?0:e.vertices[b+2];if(g){z=w-t;w=r-c;r=Math.sqrt(z*z+w*w);z/=r;w/=r;var x=
M&&!e.closed?m:Math.acos(z*y+w*E)*RAD_TO_DEG;K=J=0;L=-1;C=-w;D=z}else w-=t,x=r-c,n=z-G,r=Math.sqrt(w*w+x*x+n*n),z=w/r,w=x/r,n/=r,x=M&&!e.closed?m:Math.acos(z*y+w*E+n*N)*RAD_TO_DEG,J=0,K=1,L=0,C=1,D=0;I=0;if(!(x<m)||O)if(x>l+.001&&(a.lengths.push(0),a.angles.push(x),a.vertices.push(t,c,G),a.tangents.push(z,w,n),a.normals.push(A,v,q),a.binormals.push(J,K,L)),r>h&&(M||x>m)){A=(A+C)/2;v=(v+D)/2;y=(q+I)/2;E=Math.sqrt(A*A+v*v+y*y);if(0<E&&x<l+.001){d=!0;var F=A/E;var B=v/E;k=y/E;isNaN(F)&&(F=C);isNaN(B)&&
(B=D);isNaN(k)&&(k=I)}break}p++}a.lengths.push(r);a.angles.push(x);a.vertices.push(t,c,G);a.tangents.push(z,w,n);a.binormals.push(J,K,L);d?a.normals.push(F,B,k):a.normals.push(C,D,I);y=z;E=w;N=n;A=C;v=D;q=I;t=p}t=a.vertexCount;for(k=a.vertices.length/3-1;t<=k;){if(0<a.lengths[t]){p=t+1;if(t==k){if(!e.closed)break;p=a.vertexCount}a.edges.push(t,p)}t++}a.vertexCount=a.vertices.length/3;d<b-1&&a.holes.push(a.vertexCount)}if(g&&c)if(F=a.vertices,B=a.holes,f=0,1<b)for(d=0;d<b;d++){g=Earcut.triangulate(F,
B,3);m=g.length;if(0==m)break;for(h=0;h<m;h++)l=g[h]+f,a.faces.push(l),d<b&&l>a.holes[d]&&d++;if(d<b)for(f=a.holes[d],F=a.vertices.slice(3*f),B=a.holes.slice(d+1),h=B.length,g=0;g<h;g++)B[g]-=f}else a.faces=Earcut.triangulate(F,B,3);this.updated=!0}}}};class Segment{constructor(a={}){this.updated=a.updated||!1;this.dimensions=a.dimensions||2;this.pointStart=a.pointStart||new Vector(0,0);this.pointEnd=a.pointEnd||new Vector(1,0);this.vertices=[];a.vertices&&a.vertices.forEach(a=>{this.vertices.push(a.clone())})}update(a,c){this.updated=!0;return this.vertices}}Segment.defaultSteps=4;Segment.defaultMaxAngle=15;class Shape{constructor(a,c,b={}){this.name=a||"[Shape]";this.parent=c;this.isShape=!0;this.updated=!1;this.color=b.color||new Color(1,1,1,1);this.materialType=new Parameter("MaterialType",this,b.materialType||"lambert");this.materialSide=new Parameter("MaterialSide",this,b.materialSide||"front");this.debug=b.debug||!1;this.materialWireframe=b.materialWireframe||!0;this.indexBufferSize=this.vertexBufferSize=0;this.modifiers=[];b.modifiers&&(this.modifiers=[...b.modifiers]);this.position=b.position||
new Vector(0,0,0);this.rotation=b.rotation||new Vector(0,0,0);this.scale=b.scale||new Vector(1,1,1);this.position.parent=this;this.rotation.parent=this;this.scale.parent=this;this.geometry=new THREE.BufferGeometry;this.geometry.setAttribute("position",new THREE.Float32BufferAttribute(this.vertexBufferSize,3));this.geometry.setAttribute("normal",new THREE.Float32BufferAttribute(this.vertexBufferSize,3));this.material=new THREE.MeshPhongMaterial;this.mesh=new THREE.Mesh(this.geometry,this.material);
this.mesh.name=this.name}clone(a,c){return new Shape(a?a:this.name+"Copy",c?c:this.parent,this)}downdate(){this.updated=!1;this.parent.downdate?this.parent.downdate():this.parent.updated&&(this.parent.updated=!1)}update(a){if(!this.updated||a){a=this.position;var c=this.rotation,b=this.scale;a.updated||(a.update(),this.mesh.position.set(a.getX(),a.getY(),a.getZ()));c.updated||(c.update(),this.mesh.setRotationFromEuler(new THREE.Euler(c.x*RAD_TO_DEG,c.y*RAD_TO_DEG,c.z*RAD_TO_DEG)));b.updated||(b.update(),
this.mesh.scale.set(b.x,b.y,b.z));a=this.geometry;0>this.vertexBufferSize&&(c=new THREE.Float32BufferAttribute([0,.2,0,-.2,0,0,0,-.2,0,0,-.2,0,.2,0,0,0,.2,0,0,.2,0,-.8,1,0,-1,.8,0,-1,.8,0,-.2,0,0,0,.2,0,-.2,0,0,-1,-.8,0,-.8,-1,0,-.8,-1,0,0,-.2,0,-.2,0,0,0,-.2,0,.8,-1,0,1,-.8,0,1,-.8,0,.2,0,0,0,-.2,0,.2,0,0,1,.8,0,.8,1,0,.8,1,0,0,.2,0,.2,0,0,0,.2,0,0,-.2,0,-.2,0,0,0,-.2,0,0,.2,0,.2,0,0,0,.2,0,-1,.8,0,-.8,1,0,-1,.8,0,0,.2,0,-.2,0,0,-.2,0,0,-.8,-1,0,-1,-.8,0,-.8,-1,0,-.2,0,0,0,-.2,0,0,-.2,0,1,-.8,0,
.8,-1,0,1,-.8,0,0,-.2,0,.2,0,0,.2,0,0,.8,1,0,1,.8,0,.8,1,0,.2,0,0,0,.2,0],3),this.vertexBufferSize=c.length,a.setAttribute("position",c),a.boundingSphere=new THREE.Sphere(0,2),a.attributes.position.needsUpdate=!0,a.verticesNeedUpdate=!0,this.materialType.set("basic"),this.color=new Color(1,0,0));if(a=!this.materialType.updated||!this.materialSide.updated){switch(this.materialType.update()){case "basic":this.material=new THREE.MeshBasicMaterial;break;case "lambert":this.material=new THREE.MeshLambertMaterial;
break;case "phong":this.material=new THREE.MeshPhongMaterial;break;case "pbr":this.material=new THREE.MeshStandardMaterial;break;case "toon":this.material=new THREE.MeshToonMaterial;break;default:throw Error('Invalid material type for shape "'+this.name+'". Valid options are: "basic", "phong", "lambert", "pbr" or "toon"');}this.mesh.material=this.material;switch(this.materialSide.update()){case "front":this.material.side=THREE.FontSide;break;case "back":this.material.side=THREE.BackSide;break;case "double":this.material.side=
THREE.DoubleSide}}if(a||!this.color.updated)this.material.color=this.color.update(),this.material.opacity=this.color.a,this.material.transparent=1>this.color.a;this.updated=!0}}};class ShapeUtils{static extrude(a,c,b=0,d={}){let f=a.geometry;var g=d.cap||!0;let h=d.debug||a.debug||!1,m=d.computeNormals||!0;var l=d.sides||2,e;d=[];let k=0,q=0;1>l&&(l=1);2<l&&(l=2);var n=e=!1;if(!c||!c.isPath)throw Error("Invalid extrusion profile");c.updated||(c.update(),e=!0);var p=c.data.vertices;let u=p.length;var r=c.data.normals,t=c.data.edges,y=t.length;c=c.data.faces;let E=c.length;var A=u/3;if(0!==b){let h=!1;"number"==typeof b&&(f.extrusionDepth&&f.extrusionDepth===b||(f.extrusionDepth=
b,n=!0),b=new Path({segments:[new LineSegment({pointStart:new Vector,pointEnd:new Vector(0,0,b)})]}),h=!0);b.updated||(b.update(),n=!0);var v=b.data.vertices.length/3;if(!h){h=!0;for(var w=0;w<v;w++){var z=3*w;if(0!==b.data.vertices[z]||0!==b.data.vertices[z+1]){h=!1;break}}}if(!e&&!n)return;0==c.length&&(g=!1);e=u*(v+(1==g?(b.data.holes.length+1)*l:0));a.vertexBufferSize<e&&(a.vertexBufferSize=e,a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),a.geometry.setAttribute("normal",
new THREE.Float32BufferAttribute(e,3)));e=f.attributes.position.array;n=f.attributes.normal.array;for(l=0;l<v;l++){var x=3*l;w=b.data.vertices[x];z=b.data.vertices[x+1];var F=b.data.vertices[x+2],B=b.data.normals[x],H=b.data.normals[x+1],G=b.data.normals[x+2];let a=b.data.binormals[x],c=b.data.binormals[x+1];x=b.data.binormals[x+2];for(let b=0;b<u;b+=3){var C=p[b],D=p[b+1];let d=p[b+2];e[k++]=w+(C*B+D*a);e[k++]=z+(C*H+D*c);e[k++]=h?F+d:F+(C*G+D*x);m&&(C=r[b],D=r[b+1],n[q++]=-(C*B+D*a),n[q++]=-(C*
H+D*c),n[q++]=h?0:-(C*G+D*x))}if(l==v-1)break;w=y*l;for(z=0;z<y;z+=2)F=t[z+0]+w,B=t[z+1]+w,H=F+A,G=B+A,d.push(F),d.push(B),d.push(H),d.push(H),d.push(B),d.push(G)}if(g&&0<E)for(p=[0],p.pushArray(b.data.holes),b=0;b<p.length;b++){r=p[b];g=r*u;r=(0<r?r-1:v-1)*u;for(t=0;t<A;t++)y=r+3*t,e[k++]=e[y++],e[k++]=e[y++],e[k++]=e[y++],m&&(n[q++]=0,n[q++]=0,n[q++]=1);r=(k-u)/3;for(t=0;t<E;t+=3)d.push(c[t]+r),d.push(c[t+1]+r),d.push(c[t+2]+r);for(r=0;r<A;r++)t=g+3*r,e[k++]=e[t++],e[k++]=e[t++],e[k++]=e[t++],m&&
(n[q++]=0,n[q++]=0,n[q++]=-1);r=(k-u)/3;for(g=0;g<E;g+=3)d.push(c[g]+r),d.push(c[g+2]+r),d.push(c[g+1]+r)}}else for(e=u*l,a.vertexBufferSize<e&&(a.vertexBufferSize=e,a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),a.geometry.setAttribute("normal",new THREE.Float32BufferAttribute(e,3))),e=f.attributes.position.array,n=f.attributes.normal.array,A=0;A<l;A++){for(v=0;v<u;v++)e[k++]=p[v];if(m)for(v=0==A?1:-1,b=0;b<u;b+=3)n[q++]=0,n[q++]=0,n[q++]=v;v=u/3;for(b=0;b<E;b+=3)0==A?
(d.push(c[b]),d.push(c[b+1]),d.push(c[b+2])):(d.push(c[b]+v),d.push(c[b+2]+v),d.push(c[b+1]+v))}f.setIndex(d);f.setDrawRange(0,d.length);f.attributes.position.needsUpdate=!0;f.attributes.normal.needsUpdate=!0;f.index.needsUpdate=!0;f.verticesNeedUpdate=!0;f.normalsNeedUpdate=!0;f.elementsNeedUpdate=!0;f.boundingSphere=new THREE.Sphere(0,2);h?(a.helper||(a.helper=new THREE.VertexNormalsHelper(a.mesh,.1,65280,10),a.mesh.add(a.helper)),a.helper.update()):a.debugLines&&(a.mesh.remove(a.debugLines),a.debugLines=
null)}static readSvgPathData(a,c,b){}static readSvgPath(a,c){if(!a)throw Error("Invalid SVG path data");let b=c.path||new Path,d=c.scale||1;c=()=>{let a=parseFloat(h[m++]);1!==d&&(a*=d);return a};let f,g,h=a.split(" "),m=0;for(a=h.length;m<a;){switch(h[m++]){case "m":case "M":f=new Vector(c(),c());break;case "l":case "L":f=new Vector(c(),c());b.segments.push(new LineSegment({pointStart:g,pointEnd:f}));break;case "q":case "Q":f=new Vector(c(),c());let a=new Vector(c(),c());b.segments.push(new CurveSegment({pointStart:g,
pointEnd:f,controlPoints:[a]}))}g=f.clone()}return b}static drawMove(a){ShapeUtils.currentInitialPoint=ShapeUtils.currentPoint=a}static drawLine(a){ShapeUtils.currentPath.segments.push(new LineSegment({pointStart:ShapeUtils.currentPoint,pointEnd:a}));ShapeUtils.currentPoint=a}static drawCurve(a,c){ShapeUtils.currentPath.segments.push(new CurveSegment({pointStart:ShapeUtils.currentPoint,pointEnd:a,controlPoints:c}));ShapeUtils.currentPoint=a}static drawArc(a,c,b,d,f){ShapeUtils.currentPath.segments.push(new ArcSegment({pointStart:ShapeUtils.currentPoint,
pointEnd:a,center:c,radius:b,angleStart:d,angleEnd:f}));ShapeUtils.currentPoint=a}static convertArc(a,c,b,d,f,g,h,m,l){var e=(a-m)/2,k=(c-l)/2;f=f%360*Math.PI/180;var q=Math.cos(f),n=Math.sin(f),p=q*e+n*k;e=-n*e+q*k;b=Math.abs(b);d=Math.abs(d);k=b*b;var u=d*d,r=p*p,t=e*e,y=r/k+t/u;1<y&&(b*=Math.sqrt(y),d*=Math.sqrt(y),k=b*b,u=d*d);k=(k*u-k*t-u*r)/(k*t+u*r);k=(g==h?-1:1)*Math.sqrt(0>k?0:k);g=b*e/d*k;k*=-(d*p/b);u=(p-g)/b;r=(e-k)/d;p=(-p-g)/b;t=(-e-k)/d;y=Math.sqrt(u*u+r*r);e=180*(0>r?-1:1)*Math.acos(u/
y)/Math.PI;y=Math.sqrt((u*u+r*r)*(p*p+t*t));p=180*(0>u*t-r*p?-1:1)*Math.acos((u*p+r*t)/y)/Math.PI;0<(!h&&p)?p-=360:h&&0>p&&(p+=360);p%=360;e%=360;return new ArcSegment({center:new Vector((a+m)/2+(q*g-n*k),(c+l)/2+(n*g+q*k)),radius:new Vector(b,d),angleStart:e,angleEnd:p,angleX:f})}}ShapeUtils.currentInitialPoint=null;ShapeUtils.currentPoint=null;ShapeUtils.currentPath=null;class Invert extends Modifier{constructor(a={}){super(a);this.isInvert=!0}apply(a){console.log("Inverting");let c,b=a.length;for(c=0;c<b;c++){let b=a[c],g=[],h;for(h=b.vertices.length/2-1;0<=h;h--){var d=2*h;let a=b.vertices[d++];d=b.vertices[d++];g.push(a,d)}b.vertices=g}}};class Skew extends Modifier{constructor(a={}){super(a);this.isWarp=!0;this.factor=a.factor||1}apply(a){let c,b=a.length;for(c=0;c<b;c++){let b=a[c],f,g=b.vertices.length/2;for(f=0;f<g;f++){let a=2*f;b.vertices[a+1]+=b.vertices[a+0]*this.factor}}}};class Warp extends Modifier{constructor(a={}){super(a);this.isWarp=!0;this.sectors=a.sectors||360/Segment.defaultMaxAngle;this.factor=a.factor||360;this.offset=a.offset||0}apply(a){let c=2*Math.PI/this.sectors,b=this.offset*DEG_TO_RAD,d=this.factor*DEG_TO_RAD,f,g=a.length;for(f=0;f<g;f++){let g=a[f],p=[],u,r=g.vertices.length/2;for(u=0;u<r;u++){var h=2*u;let a=g.vertices[h++],f=g.vertices[h++];a=a*d+b;var m=Math.floor(a/c),l=m*c,e=(m+1)*c,k=(a-l)/(e-l),q=Math.sin(l)*f;l=Math.cos(l)*f;p.push(q+k*(Math.sin(e)*
f-q),l+k*(Math.cos(e)*f-l));if(u==r-1)if(g.closed)h=0;else break;e=g.vertices[h++];h=g.vertices[h++];e=e*d+b;q=Math.floor(e/c);if(m==q)continue;let n;l=f==h;let A=m<q?1:-1,v=m<q?1:0;for(l&&(n=f);m!==q;m+=A){let b=(m+v)*c;l||(k=(b-a)/(e-a),n=f+k*(h-f));k=b;p.push(Math.sin(k)*n,Math.cos(k)*n)}}g.vertices=p}}};class CirclePath extends Path{constructor(a={}){super(a);this.isCirclePath=!0;this.x=new Parameter("Center X",this,a.x,0);this.y=new Parameter("Center Y",this,a.y,0);this.radius=new Parameter("Radius",this,a.radius,1);this.polygonal=new Parameter("Polygonal",this,a.polygonal,!1);this.divisions=new Parameter("Divisions",this,{value:a.divisions,minValue:1},4);this.circularSectors=new Parameter("Circular Sectors",this,{value:a.circularSectors,minValue:4},4);this.angleStart=new Parameter("Starting Angle",
this,a.angleStart,0);this.angleEnd=new Parameter("Ending Angle",this,a.angleEnd,360);this.pie=new Parameter("Pie Mode",this,a.pie,!1);this.innerRadius=new Parameter("Inner radius",this,a.innerRadius,0);this.dimensions=2;this.update(!0)}clone(){return new CirclePath(this)}update(a,c={}){if(!this.updated||a){this.segments=[];var b=new Vector(this.x.get(),this.y.get()),d=Math.abs(this.radius.get()),f=this.polygonal.get(),g=this.divisions.get(),h=this.angleStart.get()%360,m=this.angleEnd.get()%360,l=
h==m,e=this.pie.get(),k=Math.abs(this.innerRadius.get());d<k&&(d=k,k=Math.abs(this.radius.get()));h>=m&&(m+=360);var q=[h];if(f){var n=0;for(m=(m-h)/g;n<g;)q.push(h+m*++n)}else{g=360/this.circularSectors.get();n=parseInt(h/g);for(h=parseInt(m/g);n<h;)q.push(g*++n);m!==q[q.length-1]&&q.push(m)}ShapeUtils.currentPath=this;m=q.length;for(h=0;h<m;h++){g=q[h];n=g*DEG_TO_RAD;n=new Vector(Math.cos(n)*d+b.x,Math.sin(n)*d+b.y);0==h?ShapeUtils.drawMove(n):f?ShapeUtils.drawLine(n):ShapeUtils.drawArc(n,b,d,p,
g);var p=g}d=this.segments[0].pointStart;h=this.segments[this.segments.length-1].pointEnd;if(0<k){for(h=m-1;0<=h;h--)g=q[h],n=g*DEG_TO_RAD,e=new Vector(Math.cos(n)*k+b.x,Math.sin(n)*k+b.y),h==m-1?l?ShapeUtils.drawMove(e):ShapeUtils.drawLine(e):f?ShapeUtils.drawLine(e):ShapeUtils.drawArc(e,b,k,p,g),p=g;l||ShapeUtils.drawLine(d.clone())}else!l&&e?(ShapeUtils.drawLine(b.clone()),ShapeUtils.drawLine(d.clone())):l&&!Vector.equals(d,h)&&d.clone();c.justSegments||super.update(a,c)}}};class RectanglePath extends Path{constructor(a={}){super(a);this.isRectanglePath=!0;this.x=new Parameter("X",this,a.x,0);this.y=new Parameter("Y",this,a.y,0);this.width=new Parameter("Width",this,a.width,1);this.height=new Parameter("Height",this,a.height,1);this.centered=new Parameter("Centered",this,a.centered,!1);this.rounded=new Parameter("Rounded",this,a.rounded,0);this.dimensions=2;this.update(!0,{justSegments:!0})}clone(){return new RectanglePath(this)}update(a,c={}){if(!this.updated||a){var b=
this.x.update(),d=this.y.update(),f=this.width.update(),g=this.height.update(),h=this.rounded.update(),m=this.centered.update();if(0<f){var l=b;b+=f}else l=b+f,f=-f;if(0<g){var e=d;d+=g}else e=d+g,g=-g;0>h&&(h=0);var k=f/2;var q=g/2;h>k&&(h=k);h>q&&(h=q);m&&(l-=k,b-=k,e-=q,d-=q);this.segments=[];if(0!==f||0!==g)ShapeUtils.currentPath=this,0<h?(f=new Vector(h,h),ShapeUtils.drawMove(new Vector(l+h,e)),ShapeUtils.drawLine(new Vector(b-h,e)),ShapeUtils.drawArc(new Vector(b,e+h),new Vector(b-h,e+h),f,
270,360),ShapeUtils.drawLine(new Vector(b,d-h)),ShapeUtils.drawArc(new Vector(b-h,d),new Vector(b-h,d-h),f,0,90),ShapeUtils.drawLine(new Vector(l+h,d)),ShapeUtils.drawArc(new Vector(l,d-h),new Vector(l+h,d-h),f,90,180),ShapeUtils.drawLine(new Vector(l,e+h)),ShapeUtils.drawArc(new Vector(l+h,e),new Vector(l+h,e+h),f,180,270)):(ShapeUtils.drawMove(new Vector(l,e)),ShapeUtils.drawLine(new Vector(b,e)),ShapeUtils.drawLine(new Vector(b,d)),ShapeUtils.drawLine(new Vector(l,d)),ShapeUtils.drawLine(new Vector(l,
e)));c.justSegments||super.update(a,c)}}};class ArcSegment extends Segment{constructor(a={}){super(a);this.isArcSegment=!0;this.center=a.center||new Vector(1,1);this.radius=a.radius||new Vector(1,1);this.angleStart=a.angleStart||0;this.angleEnd=a.angleEnd||0;this.angleX=a.angleX||0;this.radius.isVector||(this.radius=new Vector(this.radius,this.radius))}clone(){return new ArcSegment(this)}update(a=!1,c={}){if(!this.updated||a){c.dimensions?this.dimensions=c.dimensions:(this.dimensions=2,this.dimensions<this.pointStart.dimensions&&(this.dimensions=
this.pointStart.dimensions),this.dimensions<this.pointEnd.dimensions&&(this.dimensions=this.pointEnd.dimensions));this.vertices=this.pointStart.get();a=this.center.x;var b=this.center.y,d=this.radius.x,f=this.radius.y,g=this.angleStart,h=this.angleEnd,m=c.maxAngle||Segment.defaultMaxAngle,l=parseInt(g/m),e=parseInt(h/m);if(l!==e){let c=[],q=l;if(l<e)for(;q<e;)c.push(m*++q);else for(;q>e;)c.push(m*q--);l=c.length;for(m=0;m<l;m++)if(e=c[m],e!=g&&e!=h)for(e*=DEG_TO_RAD,this.vertices.push(a+Math.cos(e)*
d),this.vertices.push(b+Math.sin(e)*f),e=2;e<this.dimensions;e++)this.vertices.push(0)}c.skipLastPoint||this.vertices.pushArray(this.pointEnd.values);this.updated=!0;return this.vertices}}};class CurveSegment extends Segment{constructor(a={}){super(a);this.isCurveSegment=!0;this.controlPoints=a.controlPoints||[]}clone(){return new CurveSegment(this)}update(a=!1,c={}){if(!this.updated||a){this.points=[];this.points.push(this.pointStart);this.points.pushArray(this.controlPoints);this.points.push(this.pointEnd);a=this.points.length;if(3>a)throw Error("Not enough number of points");if(c.dimensions)this.dimensions=c.dimensions;else{this.dimensions=2;for(var b=0;b<a;b++)if(3==this.points[b].dimensions){this.dimensions=
3;break}}this.vertices=this.pointStart.get();if(2<a){b=[];let h=[];for(var d=0;d<a;d++){var f=this.points[d];b.push(f.x,f.y);2<this.dimensions&&b.push(f.z)}f=c.steps||Segment.defaultSteps;let m,l=this.dimensions,e,k,q,n,p;for(d=0;d<f;d++){var g=(d+1)/(f+1);for(e=a-1;0<e;e--){let c=e==a-1?b:h;for(k=0;k<e;k++)for(m=0;m<l;m++)q=k*l+m,n=c[q],p=c[q+l],h[q]=n+(p-n)*g}for(g=0;g<l;g++)this.vertices.push(h[g])}}c.skipLastPoint||this.vertices.pushArray(this.pointEnd.values);this.updated=!0;return this.vertices}}}
;class LineSegment extends Segment{constructor(a={}){super(a);this.isLineSegment=!0}clone(){return new LineSegment(this)}update(a=!1,c={}){if(!this.updated||a)return c.dimensions?this.dimensions=c.dimensions:(this.dimensions=2,this.dimensions<this.pointStart.dimensions&&(this.dimensions=this.pointStart.dimensions),this.dimensions<this.pointEnd.dimensions&&(this.dimensions=this.pointEnd.dimensions)),this.vertices=this.pointStart.get(this.dimensions),c.skipLastPoint||this.vertices.pushArray(this.pointEnd.get(this.dimensions)),
this.updated=!0,this.vertices}};class Box extends Shape{constructor(a,c,b={}){super(a||"[Box]",c,b);this.isBox=!0;this.x=new Parameter("Z",this,b.x,0);this.y=new Parameter("Y",this,b.y,0);this.z=new Parameter("Z",this,b.z,0);this.width=new Parameter("Width",this,b.width,1);this.height=new Parameter("Height",this,b.height,1);this.depth=new Parameter("Depth",this,b.depth,1);this.centered=new Parameter("Centered",this,b.pie,!1)}update(){if(!this.updated){var a=new RectanglePath({x:this.x.get(),y:this.y.get(),width:this.width.get(),
height:this.depth.get(),centered:this.centered.get(),modifiers:this.modifiers});ShapeUtils.extrude(this,a,this.height.get());super.update()}}};class Cylinder extends Shape{constructor(a,c,b={}){super(a||"[Cylinder]",c,b);this.isCylinder=!0;this.x=new Parameter("Z",this,b.x,0);this.y=new Parameter("Y",this,b.y,0);this.z=new Parameter("Z",this,b.z,0);this.radius=new Parameter("Radius",this,{value:b.radius,minValue:0},1);this.height=new Parameter("Height",this,{value:0==b.height?0:b.height||1,minValue:0});this.polygonal=new Parameter("Polygonal",this,b.polygonal||!1);this.divisions=new Parameter("Divisions",this,{value:b.divisions||12,minValue:1});
this.circularSectors=new Parameter("Circular Sectors",this,{value:b.circularSectors||4,minValue:4});this.angleStart=new Parameter("Starting Angle",this,0==b.angleStart?0:b.angleStart||360);this.angleEnd=new Parameter("Ending Angle",this,0==b.angleEnd?0:b.angleEnd||360);this.pie=new Parameter("Pie Mode",this,b.pie||!1);this.innerRadius=new Parameter("Inner radius",this,b.innerRadius||0)}update(){if(!this.updated){var a=new CirclePath({radius:this.radius.get(),polygonal:this.polygonal.get(),divisions:this.divisions.get(),
circularSectors:this.circularSectors.get(),angleStart:this.angleStart.get(),angleEnd:this.angleEnd.get(),pie:this.pie.get(),innerRadius:this.innerRadius.get()});ShapeUtils.extrude(this,a,this.height.get());super.update()}}};class Text extends Shape{constructor(a,c,b={}){super(a||"[Text]",c,b);this.isText=!0;this.text=new Parameter("text",this,b.text,0);this.x=new Parameter("Z",this,b.x,0);this.y=new Parameter("Y",this,b.y,0);this.z=new Parameter("Z",this,b.z,0);this.font=new Parameter("Font",this,b.font,1);this.depth=new Parameter("Depth",this,b.depth,.1);this.alignX=new Parameter("X Alignment",this,b.alignX,0);this.alignY=new Parameter("Y Alignment",this,b.alignY,.5);this.alignZ=new Parameter("Z Alignment",this,b.alignZ,
0);this.size=new Parameter("Size",this,b.size,1);this.alignLine=new Parameter("Line Alignment",this,b.alignLine,.5);this.numberDigits=new Parameter("Number Digits",this,b.numberDigits,2)}update(){if(!this.updated){var a=Font.instances[this.font.get()];if(a.loaded){var c=this.text.get();Number.isFinite(c)&&(c=c.toFixed(this.numberDigits.get()));var b=0,d=[],f=a.lineHeight,g=0,h=0;var m=0;var l=this.size.get();var e=this.depth.get();var k,q=c.length;for(k=0;k<q;k++){var n=c[k];if("\n"==n)b++,d.push(g),
g=0,m-=f;else if(n=a.glyphs[n])g+=n.ha,h<g&&(h=g)}d.push(g);m+=f+a.descender;this.alignX.get();m=-m*this.alignY.get();e=-e*this.alignZ.get();b=0;h*=this.alignX.get();g=h+-d[b]*this.alignLine.get();n=new Path;for(k=0;k<q;k++){var p=c[k];if("\n"==p)g=h+-d[++b]*this.alignLine.get(),m-=f;else if(p=a.glyphs[p])n.join(p.path,new Vector(g,m,e),null,new Vector(l,l,1)),g+=p.ha}ShapeUtils.extrude(this,n,this.depth.get());super.update()}}}};class Controller{constructor(a,c){this.isController=!0;this.layer=a;this.updated=!1}};class Entity{constructor(a,c,b={}){if(!a)throw Error("Undefined Entity name");this.name=new Parameter("Name",this,{value:a});this.parent=new Parameter("Parent",this,{value:c});this.isEntity=!0;this.updated=!1;this.representation=b.representation||void 0;this.position=b.position||new Vector(0,0,0);this.rotation=b.rotation||new Vector(0,0,0);this.position.parent=this;this.rotation.parent=this;this.entities=[];c&&(c.entities&&c.entities.push(this),c.representation&&this.representation&&c.representation.add(this.representation))}downdate(){this.updated=
!1;this.parent.downdate?this.parent.downdate():this.parent.updated&&(this.parent.updated=!1)}update(){if(!this.updated){var a=this.representation;if(a){var c=this.position;let b=this.rotation;c.updated||(c.update(),this.representation.position.set(c.x,c.y,c.z));b.updated||(b.update(),this.representation.setRotationFromEuler(new THREE.Euler(b.x*DEG_TO_RAD,b.y*DEG_TO_RAD,b.z*DEG_TO_RAD)));this.name.updated||(a.name=this.name.get());this.parent.updated||((c=this.parent.update())&&c.entities&&c.entities.push(this),
c&&c.representation!==a.parent&&c.representation.add(a))}else this.name.updated=this.parent.updated=!1;this.entities.forEach(a=>{a.update()});a&&(this.updated=!0)}}delete(){let a=this.representation;if(a){var c=this.parent.get();c&&c.representation==a.parent&&c.representation.remove(a)}}};class Layer{constructor(a,c,b={}){this.isLayer=!0;this.name=a||"Layer"+c.layers.length;if(!c||!c.isApp)throw Error("Invalid App for Layer '"+this.name+"'");this.app=c;this.app.layers.push(this);this.updated=!1;this.diegetic=b.diegetic||!1;this.space=b.space||new Space(this.name+"Space",c);this.widgets=[];this.camera=new Camera(this.name+"Camera");this.camera.position.setZ(-10)}update(){this.controller&&this.controller.update();this.space.update();this.representation=this.space.representation;this.camera.update();
this.widgets.forEach(a=>{a.update()});this.app.renderer.render(this.space.representation,this.camera.representation);this.updated=!0}resize(a){this.camera.aspect.set(a)}};class Space{constructor(a,c){this.isSpace=!0;this.name=a||"Space";this.representation=new THREE.Scene;this.entities=[];Space.instances.push(this)}update(){let a,c=this.entities.length;for(a=0;a<c;a++)this.entities[a].update()}}Space.instances=[];class Widget{constructor(a,c,b={}){this.name=a=a||"Widget";if(!c)throw Error("Invalid parent for Widget: "+this.name);this.parent=c;this.isWidget=!0;c=c.isWidget?c.children:c.widgets;let d=1;for(;c.includes(this.name);)this.name=a+d++;c.push(this);this.position=b.position||new Vector(0,0,0);this.rotation=b.rotation||new Vector(0,0,0);this.scale=b.scale||new Vector(1,1,1);this.size=b.size||new Vector(1,1,1);this.position.parent=this;this.rotation.parent=this;this.scale.parent=this;this.size.parent=
this;this.representation=new THREE.Object3D;this.representation.name=this.name;this.parent.isWidget?this.parent.representation.add(this.representation):this.parent.space.representation.add(this.representation);this.children=[];this.entities=[]}clone(a,c){return new Widget(a?a:this.name,c?c:this.parent,this)}downdate(){this.updated&&null!=this.parent&&(this.updated=!1,this.parent&&this.parent.downdate&&this.parent.downdate())}update(){if(!this.updated){var a=this.position,c=this.rotation,b=this.scale;
a.updated||(a.update(),this.representation.position.set(a.x,a.y,a.z));c.updated||(c.update(),this.representation.rotation.set(c.x*DEG_TO_RAD,c.y*DEG_TO_RAD,c.z*DEG_TO_RAD));b.updated||(b.update(),this.representation.scale.set(b.x,b.y,b.z));c=this.children.length;for(a=0;a<c;a++)this.children[a].update();c=this.entities.length;for(a=0;a<c;a++)this.entities[a].update();this.updated=!0}}};class CameraController extends Controller{constructor(a,c={}){super(a,c);this.isThirdPersonController=!0;this.yaw=new Parameter("Yaw (Horizontal angle)",this,c.yaw);this.pitch=new Parameter("Pitch (Vertical Angle)",this,c.pitch);this.distance=new Parameter("Distance",this,c.distance,20);this.speed=new Parameter("Rotation Speed",this,c.speed,.1);this.zoom=new Parameter("Zoom Speed",this,c.zoom,.01);this.touch=new Parameter("Touch Enabled",this,c.touch,!0);this.mouse=new Parameter("Mouse Enabled",this,
c.mouse,!0);document.addEventListener("mousedown",this.startOrbit.bind(this),!1);document.addEventListener("mousemove",this.updateOrbit.bind(this),!1);document.addEventListener("wheel",this.updateOrbit.bind(this),!1);document.addEventListener("mouseup",this.endOrbit.bind(this),!1);document.addEventListener("touchstart",this.startOrbit.bind(this),!1);document.addEventListener("touchmove",this.updateOrbit.bind(this),!1);document.addEventListener("touchend",this.endOrbit.bind(this),!1)}startOrbit(a){"touchstart"==
a.type&&(a=a.touches[0]);this.dragCursor=new Vector(a.pageX,a.pageY);this.dragYaw=this.yaw.get();this.dragPitch=this.pitch.get();this.touchSeparation=null}updateOrbit(a){let c=this.distance.get();this.yaw.get();this.pitch.get();var b=this.speed.get();let d=this.zoom.get(),f=!1,g=0,h=0,m=0;if(this.touch.get()&&"touchmove"==a.type){var l=a.touches;switch(l.length){case 1:f=!0;g=l[0].pageX;h=l[0].pageY;break;case 2:this.dragCursor=null;var e=l[0];let a=l[1];l=e.pageX-a.pageX;e=e.pageY-a.pageY;e=Math.sqrt(l*
l+e*e);this.touchSeparation&&(m=.4*(this.touchSeparation-e));this.touchSeparation=e}}if(this.mouse.get())switch(a.type){case "mousemove":f=1==a.buttons;g=a.pageX;h=a.pageY;break;case "wheel":m=a.deltaY}1==f&&this.dragCursor&&(a=(g-this.dragCursor.x)*-b+this.dragYaw,b=(h-this.dragCursor.y)*b+this.dragPitch,this.yaw.set(a),this.pitch.set(b));m&&this.distance.set(c+m*d)}endOrbit(a){this.dragCursor=null}update(){if(!this.updated){var a=this.distance.get(),c=this.yaw.get(),b=c*DEG_TO_RAD,d=this.pitch.get(),
f=d*DEG_TO_RAD,g=Math.cos(b)*Math.sin(f)*a;f=Math.cos(b)*Math.cos(f)*a;var h=this.layer.camera;h.position.setX(Math.sin(b)*a);h.position.setY(g);h.position.setZ(f);h.rotation.setY(c);h.rotation.setX(-d);h.updated=!1;this.updated=!0}}};class Camera extends Entity{constructor(a,c,b={}){super(a,c,b);this.isCamera=!0;this.type=new Parameter("type",this,b.type||"perspective");this.fov=new Parameter("fov",this,b.fov||45);this.aspect=new Parameter("aspect",this,b.aspect||1);this.width=new Parameter("width",this,b.width||1);this.height=new Parameter("height",this,b.height||1);this.near=new Parameter("near",this,b.near||.1);this.far=new Parameter("far",this,b.far||2E3)}update(){if(!this.updated){var a=this.representation;switch(this.type.get()){case "perspective":a&&
a.isPerspectiveCamera||(a=this.representation=new THREE.PerspectiveCamera);a.fov=this.fov.get();a.aspect=this.aspect.get();a.near=this.near.get();a.far=this.far.get();break;case "orthographic":a&&a.isOrthographicCamera||(a=this.representation=new THREE.OrthographicCamera);a.left=this.width.get()/-2;a.right=this.width.get()/2;a.top=this.top.get()/2;a.bottom=this.bottom.get()/-2;a.near=this.near.get();a.far=this.far.get();break;default:throw Error("Invalid camera type: "+this.type.get());}super.update();
a.updateProjectionMatrix()}}};class Geometry extends Entity{constructor(a,c,b={}){super(a,c,b);this.isGeometry=!0;this.debug=b.debug||!1;this.color=b.color||new Color(1,1,1,1);this.materialType=new Parameter("MaterialType",this,b.materialType||"basic");this.materialWireframe=b.materialWireframe||!0;this.scale=b.scale||new Vector(1,1,1);this.scale.parent=this;this.shape=new Parameter("Shape",this,{value:b.shape});this.shape.parent=this}update(){if(!this.updated){var a=this.shape.get();a&&!a.updated&&(a.parent=this,a.update(),a&&
a.mesh&&(this.representation=a.mesh));super.update();a.updated||(this.updated=!1)}}};class Light extends Entity{constructor(a,c,b={}){super(a,c,b);this.isLight=!0;this.type=new Parameter("type",this,b.type||"directional");this.color=new Parameter("color",this,b.color||16777215);this.intensity=new Parameter("intensity",this,b.intensity||1);this.distance=new Parameter("distance",this,b.distance||0);this.decay=new Parameter("decay",this,b.decay||1);this.angle=new Parameter("angle",this,b.angle||Math.PI/3);this.penumbra=new Parameter("penumbra",this,b.penumbra||0)}update(){if(!this.updated){var a=
this.representation;switch(this.type.get()){case "ambient":a&&a.isAmbientLight||(a=this.representation=new THREE.AmbientLight);a.color=new THREE.Color(this.color.get());a.intensity=this.intensity.get();break;case "point":a&&a.isPointLight||(a=this.representation=new THREE.PointLight);a.color=new THREE.Color(this.color.get());a.intensity=this.intensity.get();a.distance=this.distance.get();a.decay=this.decay.get();break;case "spot":a&&a.isSpotLight||(a=this.representation=new THREE.SpotLight);a.color=
new THREE.Color(this.color.get());a.intensity=this.intensity.get();a.distance=this.distance.get();a.decay=this.decay.get();a.angle=this.angle.get();a.penumbra=this.penumbra.get();break;case "directional":a&&a.isDirectionalLight||(a=this.representation=new THREE.DirectionalLight);a.color=new THREE.Color(this.color.get());a.intensity=this.intensity.get();break;case "hemisphere":a&&a.isHemisphereLight||(a=this.representation=new THREE.HemisphereLight);a.color=new THREE.Color(this.color.get());a.groundColor=
new THREE.Color(this.color.get());a.intensity=this.intensity.get();break;default:throw Error("Invalid camera type: "+this.type.get());}super.update()}}};class Button extends Widget{constructor(a,c,b={}){super(a,c,b);this.isButton=!0;this.style=new Parameter("Style",this,b.style,"normal");this.label=new Parameter("Label",this,b.label,"")}update(){if(!this.updated){if(!this.style.updated){this.style.get();this.entities.forEach(a=>{a.delete()});this.entities=[];this.shapes={};this.shapes.Cylinder=new Cylinder("Cylinder",this,{x:0,y:0,radius:1,height:1});for(const a in this.shapes){let c=this.shapes[a],b=c.position?c.position:new Vector(0,0,0);this.entities.push(new Geometry(a+
"Geometry",this,{shape:c,position:b}))}}super.update();this.updated=!1}}};class Gauge extends Widget{constructor(a,c,b={}){super(a,c,b);this.isGauge=!0;this.style=new Parameter("Style",this,b.style,"normal");this.label=new Parameter("Label",this,b.label,"");this.value=new Parameter("Value",this,b.value,0);this.units=new Parameter("Units",this,b.units,"");this.valueMin=new Parameter("ValueMin",this,b.valueMin,0);this.valueMax=new Parameter("ValueMax",this,b.valueMax,1);this.valueLow=new Parameter("ValueLow",this,b.valueLow,0);this.valueHigh=new Parameter("ValueHigh",this,
b.valueHigh,1);this.valueDigits=new Parameter("ValueDigits",this,b.valueDigits,0)}update(){if(!this.updated){if(!this.style.updated){this.style.get();this.entities.forEach(a=>{a.delete()});this.entities=[];this.shapes={};var a=(this.valueMax-this.valueMin)/10;switch(this.style.get()){case "normal":this.warp=new Warp({factor:270,offset:-135});this.shapes.ValueShape=new Box("ValueShape",this,{x:0,y:0,width:.01,height:.01,depth:.45,modifiers:[this.warp],position:new Vector(0,0,.01)});for(var c=0;c<=
a;c++){var b="DivisionShape"+c,d=.35+c%2*.05;this.shapes[b]=new Box(b,this,{x:1/a*c-.005,y:d,width:.01,height:.01,depth:.5-d,modifiers:[this.warp]})}this.shapes.Cylinder=new Cylinder("Cylinder",this,{x:0,y:0,radius:.1,height:.1});this.shapes.LowRangeShape=new Box("LowRangeShape",this,{x:0,y:.4,width:.1,height:.001,depth:.1,color:new Color(.25,.25,1),modifiers:[this.warp]});this.shapes.NormalRangeShape=new Box("NormalRangeShape",this,{x:.1,y:.4,width:.8,height:.001,depth:.1,color:new Color(.25,.25,
.25),modifiers:[this.warp]});this.shapes.HighRangeShape=new Box("HighRangeShape",this,{x:.9,y:.4,width:0,height:.001,depth:.1,color:new Color(1,.25,.25),modifiers:[this.warp]});this.shapes.ValueText=new Text("ValueText",this,{position:new Vector(0,-.3,0),depth:.01,size:.1,font:"Orbitron",text:this.value,numberDigits:this.valueDigits});this.shapes.UnitsText=new Text("UnitsText",this,{position:new Vector(.05,-.5,0),depth:.01,size:.05,font:"Orbitron",text:this.units,alignY:0,alignLine:0});this.shapes.LabelText=
new Text("LabelText",this,{position:new Vector(-.05,-.5,0),depth:.01,size:.05,font:"Orbitron",text:this.label,alignY:0,alignLine:1});break;case "industrial":this.warp=new Warp({factor:120,offset:-60});this.shapes.ValueShape=new Box("ValueShape",this,{x:0,y:0,width:.01,height:.01,depth:.35,modifiers:[this.warp],position:new Vector(0,0,.01),color:new Color(0,0,0)});for(c=0;c<=a;c++)b="DivisionShape"+c,d=.25+c%2*.05,this.shapes[b]=new Box(b,this,{x:1/a*c-.005,y:d,width:.01,height:.01,depth:.4-d,modifiers:[this.warp],
color:new Color(0,0,0)});this.shapes.Cylinder=new Cylinder("Cylinder",this,{x:0,y:0,radius:.05,height:.1,color:new Color(0,0,0)});this.shapes.BackCylinder=new Cylinder("Cylinder",this,{x:0,y:0,position:new Vector(0,0,-.1),radius:.5,height:.1});this.shapes.LowRangeShape=new Box("LowRangeShape",this,{x:0,y:.3,width:.1,height:.005,depth:.1,color:new Color(.25,.75,.25),modifiers:[this.warp]});this.shapes.NormalRangeShape=new Box("NormalRangeShape",this,{x:.1,y:.3,width:.8,height:.005,depth:.1,color:new Color(.25,
.25,.25),modifiers:[this.warp]});this.shapes.HighRangeShape=new Box("HighRangeShape",this,{x:.9,y:.3,width:0,height:.005,depth:.1,color:new Color(1,.25,.25),modifiers:[this.warp]});this.shapes.ValueText=new Text("ValueText",this,{position:new Vector(0,-.3,0),depth:.01,size:.1,font:"Orbitron",text:this.value,numberDigits:this.valueDigits,color:new Color(0,0,0)});this.shapes.UnitsText=new Text("UnitsText",this,{position:new Vector(0,-.4,0),depth:.01,size:.05,font:"Orbitron",text:this.units,alignY:1,
color:new Color(0,0,0)});this.shapes.LabelText=new Text("LabelText",this,{position:new Vector(0,-.2,0),depth:.01,size:.05,font:"Orbitron",text:this.label,alignY:0,color:new Color(0,0,0)});break;case "medical":this.warp=new Warp({factor:240,offset:-120});this.shapes.ValueShape=new Box("ValueShape",this,{x:-.05,y:.3,width:.1,height:.01,depth:.2,modifiers:[this.warp]});this.shapes.LowRangeShape=new Box("LowRangeShape",this,{x:0,y:.35,width:.1,height:.01,depth:.1,color:new Color(.25,.25,1),materialSide:"back",
modifiers:[this.warp]});this.shapes.NormalRangeShape=new Box("NormalRangeShape",this,{x:.1,y:.35,width:.8,height:.01,depth:.1,color:new Color(.25,.25,.25),materialSide:"back",modifiers:[this.warp]});this.shapes.HighRangeShape=new Box("HighRangeShape",this,{x:.9,y:.35,width:0,height:.01,depth:.1,color:new Color(1,.25,.25),materialSide:"back",modifiers:[this.warp]});this.shapes.ValueText=new Text("ValueText",this,{depth:.01,size:.15,font:"Orbitron",text:this.value,numberDigits:this.valueDigits});this.shapes.UnitsText=
new Text("UnitsText",this,{position:new Vector(0,-.15,0),depth:.01,size:.06,font:"Orbitron",text:this.units,alignY:1});this.shapes.LabelText=new Text("LabelText",this,{position:new Vector(0,.15,0),depth:.01,size:.06,font:"Orbitron",text:this.label,alignY:0});break;case "aerospace":this.warp=new Warp({factor:240,offset:-120});this.shapes.ValueShape=new Box("ValueShape",this,{x:0,y:.4,width:1,height:.01,depth:.1,modifiers:[this.warp]});this.shapes.MinValueShape=new Box("MinValueShape",this,{y:.35,width:-.01,
height:.01,depth:.15,modifiers:[this.warp]});this.shapes.MaxValueShape=new Box("MaxValueShape",this,{x:1,y:.35,width:.01,height:.01,depth:.15,modifiers:[this.warp]});this.shapes.LowRangeShape=new Box("LowRangeShape",this,{x:0,y:.4,width:.1,height:.01,depth:.1,color:new Color(.25,.25,1),materialSide:"back",modifiers:[this.warp]});this.shapes.NormalRangeShape=new Box("NormalRangeShape",this,{x:.1,y:.4,width:.8,height:.01,depth:.1,color:new Color(.25,.25,.25),materialSide:"back",modifiers:[this.warp]});
this.shapes.HighRangeShape=new Box("HighRangeShape",this,{x:.9,y:.4,width:0,height:.01,depth:.1,color:new Color(1,.25,.25),materialSide:"back",modifiers:[this.warp]});this.shapes.ValueText=new Text("ValueText",this,{depth:.01,size:.22,font:"Orbitron",text:this.value,numberDigits:this.valueDigits});this.shapes.UnitsText=new Text("UnitsText",this,{position:new Vector(0,-.15,0),depth:.01,size:.08,font:"Orbitron",text:this.units,alignY:1});this.shapes.LabelText=new Text("LabelText",this,{position:new Vector(0,
.15,0),depth:.01,size:.08,font:"Orbitron",text:this.label,alignY:0});break;case "futuristic":this.warp=new Warp({factor:270,offset:-180});this.shapes.ValueShape=new Box("ValueShape",this,{x:0,y:.3,width:.1,height:.01,depth:.1,position:new Vector(0,-.1,0),color:new Color(1,1,1),modifiers:[this.warp]});this.shapes.LowRangeShape=new Box("LowRangeShape",this,{x:0,y:.3,width:.1,height:.01,depth:.1,position:new Vector(0,-.1,0),color:new Color(.25,.25,1),materialSide:"back",modifiers:[this.warp]});this.shapes.NormalRangeShape=
new Box("NormalRangeShape",this,{x:.1,y:.3,width:.8,height:.01,depth:.1,color:new Color(.25,.25,.25),materialSide:"back",position:new Vector(0,-.1,0),modifiers:[this.warp]});this.shapes.HighRangeShape=new Box("HighRangeShape",this,{x:.9,y:.3,width:0,height:.01,depth:.1,color:new Color(1,.25,.25),materialSide:"back",position:new Vector(0,-.1,0),modifiers:[this.warp]});this.shapes.ValueText=new Text("ValueText",this,{position:new Vector(0,-.1,0),depth:.01,font:"Orbitron",size:.16,text:this.value,numberDigits:this.valueDigits});
this.shapes.UnitsText=new Text("UnitsText",this,{position:new Vector(.5,-.3,0),depth:.01,font:"Orbitron",size:.08,text:this.units,alignY:1,alignLine:1});this.shapes.LabelText=new Text("LabelText",this,{position:new Vector(-.5,.4,0),depth:.01,font:"Orbitron",size:.08,text:this.label,alignY:0,alignLine:0});break;default:throw Error("Invalid Style for Gauge Widget: "+this.name+'. Valid values are "normal", "futuristic"');}for(var f in this.shapes)a=this.shapes[f],c=a.position?a.position:new Vector(0,
0,0),this.entities.push(new Geometry(f+"Geometry",this,{shape:a,position:c}))}f=this.value.get();a=this.valueMin.get();c=this.valueMax.get();a>c&&(a=c,c=this.valueMin.get());f>c&&(f=c);f<a&&(f=a);b=c-a;if(0!==b){d=this.valueLow.get();let g=this.valueHigh.get();d>g&&(d=g);if(d<=a||d>=c)d=a;if(g<=a||g>=c)g=c;f=(f-a)/b;d=(d-a)/b;g=(g-a)/b;this.shapes.LowRangeShape&&this.shapes.LowRangeShape.x.set(0);this.shapes.LowRangeShape&&this.shapes.LowRangeShape.width.set(d);this.shapes.NormalRangeShape&&this.shapes.NormalRangeShape.x.set(d);
this.shapes.NormalRangeShape&&this.shapes.NormalRangeShape.width.set(g-d);this.shapes.HighRangeShape&&this.shapes.HighRangeShape.x.set(g);this.shapes.HighRangeShape&&this.shapes.HighRangeShape.width.set(1-g);"normal"==this.style||"industrial"==this.style||"medical"==this.style?this.shapes.ValueShape.x.set(f):this.shapes.ValueShape.width.set(f)}super.update();this.updated=!1}}};

//# sourceMappingURL=openuix_test.min.js.map